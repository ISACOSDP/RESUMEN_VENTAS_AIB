<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Resumen de Ventas - AIB</title>
<style>
    body { font-family: Arial, sans-serif; margin: 1em; background: #fff; color: #000; }
    .header-container { text-align: center; margin-bottom: 10px; }
    .logo { max-width: 120px; margin-bottom: 10px; }
    h2 { margin: 0; }
    p.filters { font-size: 14px; margin: 4px 0; }
    table { width: 100%; max-width: 180mm; margin: auto; border-collapse: collapse; margin-top: 1em; font-size: 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 6px; }
    th, td { padding: 6px; border: 1px solid #000; text-align: center; }
    th { background: #0056b3; color: #fff; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    tfoot td { font-weight: bold; background: #f0f0f0; }
</style>
</head>
<body>
<div class="header-container">
    <img class="logo" src="https://raw.githubusercontent.com/ISACOSDP/RECIBO_AIB/main/docs/LOGO%20AIB.png" alt="LOGO AIB">
    <h2>RESUMEN DE VENTAS - AIB</h2>
    <p class="filters">Cliente: <span id="cliente_filtro"></span> | Fecha: <span id="fecha_filtro"></span> | Estado: <span id="estado_filtro"></span></p>
</div>
<table>
    <thead>
        <tr>
            <th>FECHA</th>
            <th>CLIENTE</th>
            <th>ESTADO</th>
            <th>DETALLE</th>
            <th>SUBTOTAL</th>
            <th>IVA</th>
            <th>TOTAL</th>
        </tr>
    </thead>
    <tbody id="tabla_ventas"></tbody>
    <tfoot>
        <tr>
            <td colspan="4">TOTALES</td>
            <td id="total_subtotal">$0.00</td>
            <td id="total_iva">$0.00</td>
            <td id="total_total">$0.00</td>
        </tr>
    </tfoot>
</table>
<script>
const urlParams = new URLSearchParams(window.location.search);
document.getElementById("cliente_filtro").innerText = urlParams.get("cliente") || "Todos";
document.getElementById("fecha_filtro").innerText = urlParams.get("fecha") || "- a -";
document.getElementById("estado_filtro").innerText = urlParams.get("estado") || "Todos";

const ventasData = urlParams.get("ventas");
const tableBody = document.getElementById("tabla_ventas");

let totalSubtotal = 0;
let totalIva = 0;
let totalTotal = 0;

if (ventasData) {
    const registros = ventasData.split("|");
    registros.forEach(registro => {
        const [fecha, cliente, estado, detalle, subtotal, iva, total] = registro.split(",");
        totalSubtotal += parseFloat(subtotal);
        totalIva += parseFloat(iva);
        totalTotal += parseFloat(total);

        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${fecha}</td>
            <td>${cliente}</td>
            <td>${estado}</td>
            <td>${detalle}</td>
            <td>$${parseFloat(subtotal).toFixed(2)}</td>
            <td>$${parseFloat(iva).toFixed(2)}</td>
            <td>$${parseFloat(total).toFixed(2)}</td>
        `;
        tableBody.appendChild(row);
    });
}

document.getElementById("total_subtotal").innerText = "$" + totalSubtotal.toFixed(2);
document.getElementById("total_iva").innerText = "$" + totalIva.toFixed(2);
document.getElementById("total_total").innerText = "$" + totalTotal.toFixed(2);
</script>
</body>
</html>
